---
// Generated by Copilot
// @ts-nocheck
import { getCollection } from 'astro:content';
import Layout from '../layouts/Layout.astro';
import PostList from '../components/PostList/PostList.astro'; // Import the PostList component

// Fetch and filter products and posts
async function fetchData() {
  const products = await getCollection('products');
  const meditationProducts = await Promise.all(
    products
      .filter(product => product.data.tags && product.data.tags.includes('reading'))
      .map(async product => {
        const { Content } = await product.render();
        return { ...product, Content };
      })
  );

  const posts = await getCollection('posts');
  const meditationPosts = posts.filter(post => post.data.tags && post.data.tags.includes('reading'));

  return { meditationProducts, meditationPosts };
}

const { meditationProducts, meditationPosts } = await fetchData();
const productSchema = {
  "@context": "https://schema.org",
  "@type": "AudioObject",
  "name": "STEM Meditation",
  "description": "This is a free educational STEM-themed meditation available on Spotify.",
  "contentUrl": "https://open.spotify.com/album/5csV743mINz7bY6b5uX8Wo",
  "encodingFormat": "audio/ogg",
  "duration": "PT1H14M",  // Duration in ISO 8601 format (e.g., PT30M for 30 minutes)
  "inLanguage": "en",
  "isAccessibleForFree": true,
  "educationalUse": "chemistry, physics, meditation",
  "genre": "Educational",
  "provider": {
    "@type": "Organization",
    "name": "Stimsims",
    "url": Astro.site
  },
  "publisher": {
    "@type": "Organization",
    "name": "Stimsims",
    "url": Astro.site
  }
}
---

<Layout title="The Secret Palace in the Chimney | Children's Book">
  <script type="application/ld+json" set:html={JSON.stringify(productSchema)} />
  <div class="products">
    {meditationProducts.map(product => (
      <div class="product" key={product.slug}>
        <div>
          <product.Content />
        </div>
      </div>
    ))}
  </div>
  <h2 class="text-centre">Related Posts:</h2>
  <PostList posts={meditationPosts} /> <!-- Generated by Copilot -->
</Layout>